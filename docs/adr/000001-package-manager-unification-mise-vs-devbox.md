# 000001-パッケージマネージャー統一（mise vs devbox）

## コンテキスト

> アーキテクチャの意思決定をする際の背景や文脈を記述する。なぜこの決定をしなければならなかったのか

- 現状、ツール導入が `brew` と `mise` に分散しており、環境構築手順・更新手順・責務分担が曖昧になっている。
- 目的は「開発環境の再現性向上」「セットアップの単純化」「更新/保守コストの低減」「（将来的な）チーム共有や CI 連携のしやすさ」。
- 候補として以下を検討する:
  - **mise に統一**（主に言語ランタイム・CLI ツールのバージョン管理を担う）
  - **devbox（Nix 系）へ移行**（開発環境を Nix で宣言的に固定・配布する）

## 決定

> 決定事項について、詳細に説明する。
> なぜこの選択を選んだのか。

**当面は mise に統一する。**  
ただし、`brew` は完全廃止せず **「OS 統合が強いもの（GUI アプリ/ドライバ/フォント等）に限定」**し、開発用 CLI・ランタイムは原則 `mise` 管理とする。

理由:

- 現状すでに `mise` が導入されており、移行コストが最小で、運用をすぐ単純化できる。
- dotfiles 前提の個人環境では、Nix 導入（学習/トラブルシュート/ポリシー決め）が過剰になりやすい。
- `devbox` は再現性の強みが大きい一方で、Nix 特有の運用（キャッシュ、ビルド、権限/隔離、互換性）を受け入れる必要がある。
- 将来、チーム標準化や CI の完全固定が強く求められる段階になったら **devbox への再検討**余地を残す（現時点の優先度は低い）。

運用ポリシー（案）:

- **mise 管理**: 言語ランタイム（node/python/ruby/go 等）と、開発用途の CLI（可能な範囲）。
- **brew 管理**: macOS との統合が強いもの（GUI アプリ、フォント、ドライバ、OS 連携ツール等）。
- **判断に迷うもの**: 「プロジェクト間で同一バージョンが重要か？」が Yes なら mise、No なら brew（または現状維持）。

## 考慮した選択肢

> 考えられる選択肢を図解なども含めて分かりやすく記述する。
> メリット・デメリットなど。

### 選択肢 A: mise に統一（推奨）

- 位置づけ: ランタイム/CLI ツール/プロジェクトツールのバージョン管理を `mise` に集約する。
- 運用イメージ:
  - ランタイム（例: node, python, ruby, go）を `mise` で固定
  - CLI（例: ripgrep, fd, jq, gh 等）も `mise` で管理できる範囲は `mise`
  - `brew` は OS 依存が強いものに限定（完全排除をゴールにしない）

### 選択肢 B: devbox（Nix）へ移行

- 位置づけ: `devbox.json` 等に開発環境を宣言し、Nix で依存を固定する。
- 運用イメージ:
  - プロジェクト/リポジトリ単位で devbox を有効化し、必要パッケージを宣言
  - シェルに入ることで揃った環境を得る（direnv 等と相性が良いことが多い）

### 比較観点（要点）

- 再現性/固定力:
  - **devbox > mise**（Nix は依存解決の固定が強い）
- 導入/学習/運用コスト:
  - **mise > devbox**（mise の方が軽量で馴染みやすい）
- macOS（個人 PC）との親和性:
  - **mise >= devbox**（devbox でも可能だが、Nix 前提の設計/理解が必要）
- トラブルシュート容易性:
  - **mise > devbox**（Nix 特有の問題領域が増えやすい）
- dotfiles との相性:
  - 個人用途では **mise が扱いやすい**。devbox は「プロジェクト配布」には強い。

## 影響

> 何が簡単になるのか、何がより難しくなるのか、また変更によって導入される軽減が必要なリスク。

### メリット

- `brew/mise` の責務が明確になり、セットアップ手順が整理される。
- ランタイム・CLI のバージョン差異が減り、再現性が向上する。
- 更新手順（mise update 等）を中心に運用を単純化できる。

### デメリット

- `mise` で管理しづらい（または対象外の）パッケージがあり、`brew` を完全には排除できない可能性がある。
- devbox ほどの「環境の完全固定」は得にくい（OS 差分や依存の揺れが残り得る）。

### リスク

- 既存ツールの導入経路が混在し続けると、統一の効果が薄れる。
  - 軽減策: **「ランタイム/CLI は mise」「OS 統合は brew」**のルールを明文化し、追加時の判断基準を固定する。
- 将来チーム共有/CI 固定が強く必要になった場合、mise 運用では限界が出る可能性がある。
  - 軽減策: その時点で devbox（Nix）を再評価し、プロジェクト単位で段階導入する。
